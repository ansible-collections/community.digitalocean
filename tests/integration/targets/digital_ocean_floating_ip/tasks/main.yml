---

- name: Ensure API key is provided
  ansible.builtin.fail:
    msg: do_api_key should be defined in tests/integration/integration_config.yml
  when:
    - do_api_key is not defined
    - do_api_key | length == 0

- name: "Make sure that the Floating IP is absent"
  community.digitalocean.digital_ocean_floating_ip:
    state: absent
    ip: "8.8.8.8"
    oauth_token: "{{ do_api_key }}"
  register: result

- name: Verify that the Floating IP didn't change
  ansible.builtin.assert:
    that:
      - "not result.changed"

- name: "Create a Floating IP"
  community.digitalocean.digital_ocean_floating_ip:
    state: present
    region: "{{ do_region }}"
    oauth_token: "{{ do_api_key }}"
  register: result

- name: Verify that a Floating IP was created
  ansible.builtin.assert:
    that:
      - "result.changed"

- name: "Destroy Floating IP"
  community.digitalocean.digital_ocean_floating_ip:
    state: absent
    ip: "{{ result.data.floating_ip.ip }}"
    region: "{{ do_region }}"
    oauth_token: "{{ do_api_key }}"
  register: result

- name: Verify that a Floating IP was deleted
  ansible.builtin.assert:
    that:
      - " result.changed"
