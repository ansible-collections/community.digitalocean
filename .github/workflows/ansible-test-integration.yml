name: integration

on:
  push:
    branches:
      - ci
    # paths:
    #   - plugins/module_utils/**
    #   - plugins/modules/**

concurrency:
  group: ci-cloud-integration-tests
  cancel-in-progress: false

jobs:

  changed-files:
    runs-on: ubuntu-latest
    name: changed-files
    steps:

      - name: Get changed files
        id: changed-files
        uses: tj-actions/changed-files@v21

    outputs:
      changed-files: ${{ steps.changed-files.outputs.all_changed_files }}

  test-job:
    runs-on: ubuntu-latest
    name: changed-files
    steps:

      - name: Debugging
        run: |
          echo "${{ job.changed-files.changed-files }}"

  # integration-module:
  #   uses: ansible-collections/community.digitalocean/.github/workflows/ansible-test-integration-module.yml@ci
  #   with:
  #     # module: digital_ocean_account_info
  #     module: ${{ job.changed-files.changed-files }}
  #   secrets: inherit

  # integration:
  #   runs-on: ubuntu-latest
  #   timeout-minutes: 120
  #   steps:
  #     - name: Perform testing (digital_ocean_spaces_info)
  #       uses: ansible-community/ansible-test-gh-action@unstable/v1
  #       with:
  #         # ansible-core-version:
  #         target: digital_ocean_spaces_info
  #         pre-test-cmd: >-  # Configure integration test run
  #           DO_API_KEY=${{ secrets.DO_API_KEY }}
  #           AWS_ACCESS_KEY_ID=${{ secrets.AWS_ACCESS_KEY_ID }}
  #           AWS_SECRET_ACCESS_KEY=${{ secrets.AWS_SECRET_ACCESS_KEY }}
  #           ./tests/utils/render.sh
  #           tests/integration/integration_config.yml.template
  #           > tests/integration/integration_config.yml
  #         python-version: 3.9
  #         target-python-version: 3.9
  #         testing-type: integration
  #         test-deps: community.general

  #     - name: Perform testing (digital_ocean_spaces)
  #       uses: ansible-community/ansible-test-gh-action@unstable/v1
  #       with:
  #         # ansible-core-version:
  #         target: digital_ocean_spaces
  #         pre-test-cmd: >-  # Configure integration test run
  #           DO_API_KEY=${{ secrets.DO_API_KEY }}
  #           AWS_ACCESS_KEY_ID=${{ secrets.AWS_ACCESS_KEY_ID }}
  #           AWS_SECRET_ACCESS_KEY=${{ secrets.AWS_SECRET_ACCESS_KEY }}
  #           ./tests/utils/render.sh
  #           tests/integration/integration_config.yml.template
  #           > tests/integration/integration_config.yml
  #         python-version: 3.9
  #         target-python-version: 3.9
  #         testing-type: integration
  #         test-deps: community.general

  #     # - name: Perform testing
  #     #   uses: ansible-community/ansible-test-gh-action@release/v1
  #     #   with:
  #     #     # ansible-core-version:
  #     #     pre-test-cmd: >-  # Configure integration test run
  #     #       DO_API_KEY=${{ secrets.DO_API_KEY }}
  #     #       ./tests/utils/render.sh
  #     #       tests/integration/integration_config.yml.template
  #     #       > tests/integration/integration_config.yml
  #     #     python-version: 3.9
  #     #     target-python-version: 3.8
  #     #     testing-type: integration
  #     #     test-deps: community.general
